<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[å¤æ ‘æ­£èŒ‚]]></title>
  <link href="http://summertreee.github.io/atom.xml" rel="self"/>
  <link href="http://summertreee.github.io/"/>
  <updated>2015-11-22T22:25:26+08:00</updated>
  <id>http://summertreee.github.io/</id>
  <author>
    <name><![CDATA[æ¢ç‚œV]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Auto Layoutä½¿ç”¨å°æŠ€å·§]]></title>
    <link href="http://summertreee.github.io/blog/2015/11/22/auto-layoutshi-yong-xiao-ji-qiao/"/>
    <updated>2015-11-22T22:20:31+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/11/22/auto-layoutshi-yong-xiao-ji-qiao</id>
    <content type="html"><![CDATA[<p>ç›®å‰ç”±äºAppleè‡ªå·±çš„Auto Layoutå†™æ³•æ¯”è¾ƒå•°å—¦ï¼Œæ‰€ä»¥å‡ºç°äº†è®¸å¤šå¯¹åŸç”Ÿè¯­å¥è¿›è¡Œå°è£…çš„ç¬¬ä¸‰æ–¹å¼€å‘åº“ï¼Œè¿™å…¶ä¸­<code>Masonry</code>å¹¿å—å¼€å‘è€…çš„å–œçˆ±ï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½ä»¥<code>Masonry</code>æ¥åšæ¼”ç¤ºè¯´æ˜ï¼Œä½†å¯¹äºAppleåŸç”Ÿçš„å†™æ³•ä¹ŸåŒæ ·é€‚ç”¨ã€‚</p>

<h3>1ã€å›¾ç‰‡+æ–‡å­—å±…ä¸­æ˜¾ç¤º</h3>

<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šä¸€å¼ å›¾ç‰‡æ—è¾¹æ¥ä¸Šä¸€æ®µæ–‡å­—ï¼Œç„¶åè®©ä»–ä»¬ç›¸å¯¹äºçˆ¶è§†å›¾å±…ä¸­æ˜¾ç¤ºï¼Œä»¥å‰æˆ‘çš„åšæ³•æ˜¯å…ˆçŸ¥é“å›¾ç‰‡çš„å°ºå¯¸ï¼Œç„¶åæ¥è®¡ç®—ä»–ä»¬ç›¸å¯¹äºçˆ¶è§†å›¾ä¸­å¿ƒçš„åç§»é‡ï¼Œå†è¿›è¡Œå¸ƒå±€ã€‚éœ€æ±‚çš„æ ·å¼å¤§è‡´å¦‚ä¸‹ï¼š</p>

<p><img src="http://summertreee.github.io/Users/baidu/Desktop/yangshi.png" alt="å¤§è‡´æ•ˆæœ" /></p>

<p>ä½†æ˜¯è¿™æ ·çš„ç¼ºç‚¹æ˜¯æ¯æ¬¡éƒ½éœ€è¦å»æ®ç®—è·ç¦»ä¸­å¿ƒçš„åç§»é‡ï¼Œå¾ˆéº»çƒ¦ï¼Œå¯¹äºè¿™ç§æƒ…å†µå…¶å®å¯ä»¥æ·»åŠ ä¸€ä¸ªè¾…åŠ©è§†å›¾ï¼Œè®©è¿™ä¸ªè¾…åŠ©è§†å›¾çš„å·¦è¾¹ç­‰äºå›¾ç‰‡çš„å·¦è¾¹ï¼Œå³è¾¹å’Œæ–‡å­—çš„å³è¾¹å¯¹é½ï¼Œç„¶åè¿™ä¸ªè¾…åŠ©è§†å›¾ç›¸å¯¹äºçˆ¶è§†å›¾å±…ä¸­æ˜¾ç¤ºå°±è¡Œã€‚</p>

<pre><code>- (void)layoutImageAndText {
UIImageView *imageView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"av_colum"]];
[self.view addSubview:imageView];
[imageView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.equalTo(@10);
    make.left.greaterThanOrEqualTo(self.view);
}];

UILabel *label = [UILabel new];
label.text = @"æ¢æœä¼Ÿ";
label.font = [UIFont systemFontOfSize:17];
label.textAlignment = NSTextAlignmentLeft;
label.backgroundColor = [UIColor clearColor];
[self.view addSubview:label];
[label mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.equalTo(imageView.mas_right).offset(5);
    make.centerY.equalTo(imageView);
}];

UIView *limitView = [UIView new];
[self.view addSubview:limitView];
[limitView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.equalTo(imageView);//å’Œå›¾ç‰‡å·¦è¾¹å¯¹é½
    make.right.equalTo(label);//å’Œæ–‡å­—å³è¾¹å¯¹é½
    make.centerX.equalTo(self.view);//æŒ‡å®šlimitViewå±…ä¸­æ˜¾ç¤º
}];
}
</code></pre>

<h3>2ã€å¤„ç†å¤åˆå‹å¸ƒå±€</h3>

<p>ç›´æ¥ä¸Šå›¾è¯´æ˜éœ€æ±‚ï¼Œé¡µé¢ä¸Šæœ‰å››ä¸ªå¯è§çš„è§†å›¾ï¼šçº¢ã€ç»¿ã€è“ä¸‰ä¸ª<code>UIView</code>ï¼Œæœ€ä¸‹é¢æ˜¯ä¸€ä¸ª<code>UIButton</code>,æƒ³è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯ç‚¹å‡»buttonè§¦å‘äº‹ä»¶å°†ä¸­é—´çš„ç»¿è‰²è§†å›¾éšè—ï¼Œä¸‹é¢çš„è“è‰²è§†å›¾å’Œbuttonç§»åŠ¨åˆ°çº¢è‰²è§†å›¾ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://summertreee.github.io/Users/baidu/Desktop/3.gif" alt="éœ€è¦çš„æ•ˆæœ" /></p>

<p>å¦‚æœåªæ˜¯å°†ä¸­é—´çš„ç»¿è‰²çš„è§†å›¾hiddenæ‰ï¼Œæ˜¯è¾¾ä¸åˆ°è¿™æ ·çš„æ•ˆæœçš„ï¼š</p>

<p><img src="http://summertreee.github.io/Users/baidu/Desktop/33.png" alt="å½±è—ä¸­é—´çš„ç»¿è‰²è§†å›¾" /></p>

<p>è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœå¯ä»¥åˆ©ç”¨<code>MASConstraint</code>çš„<code>deactivate</code>å’Œ<code>activate</code>æ–¹æ³•ï¼Œä»–ä»¬çš„ä½œç”¨æ˜¯è®©ä¸€ä¸ªconstraint<strong>ä¸ç”Ÿæ•ˆ</strong>å’Œ<strong>ç”Ÿæ•ˆ</strong>ï¼Œ<code>Masonry</code>çš„æ¯ä¸ªConstraintéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª<code>MASConstraint</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿å­˜ä¸€äº›éœ€è¦æ”¹å˜çš„constraintï¼Œåœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>

<pre><code>//.h
@interface ViewController ()

@property (nonatomic, strong) UIView *greenView;
@property (nonatomic, strong) MASConstraint *gHeightConstraint;//ä¿å­˜å…³é”®çš„constraint

@end
//.m
@implementation ViewController

- (void)testComplexLayout {
NSNumber *viewHeight = @80;
UIView *redView = [UIView new];
redView.backgroundColor = [UIColor redColor];
[self.view addSubview:redView];
[redView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.left.right.equalTo(self.view);
    make.height.equalTo(viewHeight);
}];

_greenView = [UIView new];
[self.view addSubview:_greenView];
[_greenView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.right.equalTo(redView);
    make.top.equalTo(redView.mas_bottom);
    self.gHeightConstraint = make.height.equalTo(@0).priorityHigh();//è®¾ä¸ºé«˜ä¼˜å…ˆçº§ï¼Œé¦–å…ˆæ»¡è¶³å®ƒçš„éœ€æ±‚
}];
[self.gHeightConstraint deactivate];//æœ€å¼€å§‹è®©å®ƒä¸ç”Ÿæ•ˆï¼Œå°±æ˜¯é«˜ä¸º0çš„é™åˆ¶æš‚ä¸ç”Ÿæ•ˆ
_greenView.clipsToBounds = YES;//ä¸æ˜¾ç¤ºè¶…è¿‡boundsæœ¬èº«çš„éƒ¨åˆ†ï¼Œå› ä¸ºåœ¨å®ƒé‡Œé¢åŠ äº†subView
//subGreenViewæ˜¯çœŸå®çš„æ˜¾ç¤ºç»¿è‰²éƒ¨åˆ†ï¼Œå®ƒæ·»åŠ åœ¨greenViewä¸Š
UIView *subGreenView = [UIView new];
subGreenView.backgroundColor = [UIColor greenColor];
[_greenView addSubview:subGreenView];
[subGreenView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.edges.equalTo(self.greenView).priorityLow();
    make.height.equalTo(viewHeight);
}];

UIView *blueView = [UIView new];
blueView.backgroundColor = [UIColor blueColor];
[self.view addSubview:blueView];
[blueView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.height.left.right.equalTo(redView);
    make.top.equalTo(self.greenView.mas_bottom);
}];

UIButton *hiddenButton = [UIButton buttonWithType:UIButtonTypeCustom];
[hiddenButton setTitle:@"å½±è—ä¸­é—´çš„View" forState:UIControlStateNormal];
[hiddenButton addTarget:self action:@selector(hiddenAction:) forControlEvents:UIControlEventTouchUpInside];
[hiddenButton setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
[self.view addSubview:hiddenButton];
[hiddenButton mas_makeConstraints:^(MASConstraintMaker *make) {
    make.centerX.equalTo(self.view);
    make.top.equalTo(blueView.mas_bottom).offset(40);
}];
}

static bool isActive = NO;
- (void)hiddenAction:(id)sender {
if (isActive) {
    [_gHeightConstraint deactivate];
} else {
    [_gHeightConstraint activate];
}
//åŠ¨ç”»å±•ç¤º
[UIView animateWithDuration:.25 animations:^{
    [self.view layoutIfNeeded];
}];

isActive = !isActive;
}
</code></pre>

<h3>3ã€Previewçš„ä½¿ç”¨</h3>

<p>è¿™æ®µæ—¶é—´åœ¨å­¦ä¹ storyBoardç›¸å…³çš„ä¸€äº›çŸ¥è¯†ï¼ŒRWä¸Šçš„ä¸¤ç¯‡æ–‡ç« ï¼š<a href="http://www.raywenderlich.com/50308/storyboards-tutorial-in-ios-7-part-1">Part1</a>å’Œ<a href="http://www.raywenderlich.com/50310/storyboards-tutorial-in-ios-7-part-2">Part2</a>éå¸¸é€‚åˆåˆå­¦è€…å­¦ä¹ ï¼Œå·²ç»æœ‰äººç¿»è¯‘æˆäº†ä¸­æ–‡<a href="http://www.cocoachina.com/industry/20131213/7537.html">Part1</a>ï¼Œ<a href="http://blog.sina.com.cn/s/blog_5c5c87d80101dzyh.html">Part2</a>ã€‚</p>

<p><code>Xcode</code>æä¾›äº†ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½<code>Preview</code>ã€‚å½“æˆ‘ä»¬åœ¨<code>Storyboard</code>ä¸Šä½¿ç”¨<code>Auto Layout</code>ä¸Šè¿›è¡Œå¸ƒå±€ä»¥åï¼Œç”±äºç›®å‰çš„ç”»å¸ƒ<code>canvas</code>å·²ç»æ²¡æœ‰å°ºå¯¸çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¸ƒå±€å®Œæˆåéœ€è¦åœ¨3.5ã€4.0ã€4.7ã€5.5è‹±å¯¸çš„è®¾å¤‡ä¸Šæµ‹è¯•ï¼Œå¦‚æœæ”¯æŒæ—‹è½¬æˆ–è€…æ”¯æŒiPadï¼Œä¸€ä¸ªæ•ˆæœæˆ‘ä»¬ä¼šbuildå¤šæ¬¡åœ¨ä¸åŒçš„è®¾å¤‡ä¸ŠæŸ¥çœ‹æ•ˆæœã€‚éå¸¸çš„éº»çƒ¦ï¼Œä½†æ˜¯æœ‰äº†<code>Preview</code>åä¸€åˆ‡éƒ½å˜å¾—ç®€å•èµ·æ¥ã€‚
ä½¿ç”¨<code>Preview</code>çš„æ­¥å¥å¦‚ä¸‹ï¼š</p>

<p>1ã€é€‰ä¸­<code>Main.storyboard</code>,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€‰å–çš„æ—¶å€™æŒ‰ä¸‹<code>option+shift</code>æŒ‰é”®ã€‚</p>

<p><img src="http://summertreee.github.io/Users/baidu/Desktop/44.png" alt="é€‰æ‹©storyboard" /></p>

<p>2ã€é€‰å–<code>Preview</code>åä¼šå‡ºæ¥å¦‚ä¸‹çš„ç•Œé¢ï¼Œé€‰æ‹©ç•Œé¢å³è¾¹çš„<code>+</code>å·ï¼ŒæŒ‰<code>å›è½¦</code>ã€‚</p>

<p><img src="http://summertreee.github.io/Users/baidu/Desktop/55.png" alt="image" /></p>

<p>3ã€é€šè¿‡æ­¥éª¤<code>2</code>åï¼Œä¼šå‡ºç°ä»¥ä¸‹çš„ç•Œé¢ï¼š</p>

<p><img src="http://summertreee.github.io/Users/baidu/Desktop/66.png" height="520" width="500" alt="Previewç•Œé¢" /></p>

<p>å…³é”®çš„å‡ ä¸ªåœ°æ–¹æˆ‘éƒ½ç”¨çº¢æ–¹æ¡†åœˆäº†èµ·æ¥ï¼Œå·¦ä¸‹è§’çš„<code>+</code>èƒ½æ¨¡æ‹Ÿä¸åŒçš„è®¾å¤‡ï¼Œä¸­é—´çš„çº¢æ¡†éƒ¨ä½å¯ä»¥æ¨¡æ‹Ÿè®¾å¤‡çš„æ—‹è½¬ï¼Œ
å³ä¸‹è§’çš„<code>English</code>éƒ¨ä½å¯ä»¥æ¨¡æ‹Ÿå¸ƒå±€ä¸­çš„æ–‡å­¦ä¿¡æ¯åŒå€åçš„å¸ƒå±€è¡¨ç°ï¼Œè¿™å‡ ä¸ªåŠŸèƒ½éƒ½éå¸¸çš„æ–¹ä¾¿ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Appä¸­æ‹¨æ‰“ç”µè¯ä¸€ç‚¹å°æ€»ç»“]]></title>
    <link href="http://summertreee.github.io/blog/2015/08/23/appzhong-bo-da-dian-hua-%5B%3F%5D-dian-xiao-zong-jie/"/>
    <updated>2015-08-23T12:27:08+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/08/23/appzhong-bo-da-dian-hua-[?]-dian-xiao-zong-jie</id>
    <content type="html"><![CDATA[<h3>Appå†…å‘èµ·ç”µè¯æ‹¨æ‰“çš„ä¸€ç‚¹å°æŠ€å·§</h3>

<h4>ä¸€ã€æ‹¨æ‰“ç”µè¯</h4>

<p>åœ¨Appå†…å‘èµ·ç”µè¯æ‹¨æ‰“ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>

<p>1ã€åˆ©ç”¨è¿™ç§æ–¹å¼å‘èµ·çš„ç”µè¯æ‹¨æ‰“ï¼Œé€šè¯ç»“æŸåä¸ä¼šç›´æ¥è¿”å›Appå†…ï¼Œè€Œæ˜¯åœç•™åœ¨é€šä¿¡å½•é‡Œé¢ï¼š</p>

<pre><code> NSString *str = [[NSString alloc] initWithFormat:@"tel:%@",@"131xxxx1909"];
[[UIApplication sharedApplication] openURL:[NSURL URLWithString:str]];
</code></pre>

<!--more-->


<p>2ã€åˆ©ç”¨<code>UIWebView</code>å®ç°ç”µè¯æ‹¨æ‰“ï¼Œä¼šå¼¹å‡ºæ‹¨æ‰“æç¤ºï¼Œå¹¶ä¸”æ‹¨æ‰“å®Œæˆåä¼šè¿”å›Appå†…ï¼š</p>

<pre><code>NSString *phone = @"131****1909";
NSString *cleanedString =[[phone componentsSeparatedByCharactersInSet:[[NSCharacterSet characterSetWithCharactersInString:@"0123456789-+()"] invertedSet]] componentsJoinedByString:@""];
NSString *escapedPhoneNumber = [cleanedString stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];
NSURL *telURL = [NSURL URLWithString:[NSString stringWithFormat:@"tel://%@",escapedPhoneNumber]];
UIWebView *mCallWebview = [[UIWebView alloc] init] ;

[self.view addSubview:mCallWebview];
[mCallWebview loadRequest:[NSURLRequest requestWithURL:telURL]];
</code></pre>

<h4>äºŒã€æ£€æµ‹é€šè¯æ—¶é—´</h4>

<p>åˆ©ç”¨<code>CTCallCenter</code>æˆ‘ä»¬å¯ä»¥æ£€æµ‹åœ¨ä½¿ç”¨AppæœŸé—´æ‹¨æ‰“ç”µè¯å‡ºå»ä»¥åŠç”µè¯æ‰“å…¥çš„æ—¶æœºï¼Œä»¥åŠé€šè¯ç»“æŸçš„æ—¶æœºã€‚å®ç°å¦‚ä¸‹ï¼š</p>

<pre><code> #import &lt;CoreTelephony/CTCallCenter.h&gt;
 #import &lt;CoreTelephony/CTCall.h&gt;

 @interface AppDelegate : UIResponder&lt;UIApplicationDelegate&gt;
 @property (nonatomic, strong) CTCallCenter *callCenter;
 @end

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  self.callCenter = [[CTCallCenter alloc] init];
  [self handleCall];
  return YES;
}

-(void)handleCall
{
   self.callCenter.callEventHandler = ^(CTCall *call) {
    if ([call.callState isEqualToString: CTCallStateConnected])
    {
        NSLog(@"æ¥é€šç”µè¯");
    }
    else if ([call.callState isEqualToString: CTCallStateDialing])
    {
        NSLog(@"å‘èµ·å‘¼å«");
    }
    else if ([call.callState isEqualToString: CTCallStateDisconnected])
    {
        NSLog(@"ç»“æŸç”µè¯");
    }
    else if ([call.callState isEqualToString: CTCallStateIncoming])
    {
        NSLog(@"æ‰“å…¥ç”µè¯");
    }
   };
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xcodeæ§åˆ¶å°æ‰“å°CGRect]]></title>
    <link href="http://summertreee.github.io/blog/2015/06/15/xcodekong-zhi-tai-da-yin-cgrect/"/>
    <updated>2015-06-15T21:15:58+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/06/15/xcodekong-zhi-tai-da-yin-cgrect</id>
    <content type="html"><![CDATA[<p>åœ¨ç”¨Xcodeè°ƒè¯•å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨æ§åˆ¶å°æ‰“å°æŸä¸ªè§†å›¾çš„frameï¼Œä»¥å‰çš„æ—¶å€™ç›¸å½“éº»çƒ¦ï¼Œä½†æ˜¯ä»Xcode6.3ä»¥åï¼Œæ‰“å°frameå˜å¾—å¾ˆç®€å•ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Before
</span><span class='line'>(lldb) p (CGRect) [self frame]
</span><span class='line'>(CGRect) $0 = (origin = (x = 0, y = 0), size = (width = 50, height = 100))
</span><span class='line'> 
</span><span class='line'>// After
</span><span class='line'>(lldb) expr @import UIKit
</span><span class='line'>(lldb) p self.frame
</span><span class='line'>(CGRect) $1 = (origin = (x = 0, y = 0), size = (width = 50, height = 100))
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AFNetworking2.0ä½¿ç”¨å¿ƒå¾—]]></title>
    <link href="http://summertreee.github.io/blog/2015/05/13/afnetworking2-dot-0shi-yong-xin-de/"/>
    <updated>2015-05-13T13:56:23+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/05/13/afnetworking2-dot-0shi-yong-xin-de</id>
    <content type="html"><![CDATA[<p>è¿™æ®µæ—¶é—´è¦å°†å…¬å¸é¡¹ç›®ä¸­çš„ç½‘ç»œå¼•æ“ç”±<a href="http://allseeing-i.com/ASIHTTPRequest/">ASIHTTPRequest</a>æ›¿æ¢ä¸º<a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a>,æ›¿æ¢çš„è¿‡ç¨‹æ¯”è¾ƒæ›²æŠ˜ï¼Œåœ¨æ­¤è®°å½•ä¸‹è‡ªå·±æ›¿æ¢è¿‡ç¨‹ä¸­å¾—å¿ƒå¾—ï¼š</p>

<h3>1ã€å»ºç«‹æ•°æ®è¯·æ±‚ä¸­ä»‹è€…</h3>

<p>å»ºç«‹<code>ä¸­ä»‹è€…</code>æ˜¯æŒ‡é¡¹ç›®ä¸­çš„æ•°æ®è¯·æ±‚éƒ½é€šè¿‡å®ƒå»å®ç°ï¼Œè€Œä¸æ˜¯æ¯ä¸€ä¸ªæ•°æ®è¯·æ±‚éƒ½ç›´æ¥ä¸<code>AFNetworking</code>æ‰“äº¤é“ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>

<ul>
<li>å°†ç½‘ç»œè¯·æ±‚ä¸ç¬¬ä¸‰æ–¹åº“ä¾èµ–éš”ç¦»å¼€æ¥ï¼Œæ–¹ä¾¿ä»¥åå¯¹ç¬¬ä¸‰æ–¹åº“çš„æ›¿æ¢ã€‚</li>
<li>æ–¹ä¾¿å¤„ç†ç½‘ç»œè¯·æ±‚çš„å…¬å…±é€»è¾‘ã€‚</li>
</ul>


<!--more-->


<h3>2ã€ä½¿ç”¨completionQueue</h3>

<p>é»˜è®¤æƒ…å†µä¸‹<code>AFURLConnectionOperation</code>æˆ–è€…<code>AFHTTPRequestOperation</code>è¯·æ±‚ç»“æŸä»¥åä¼šåœ¨ä¸»çº¿ç¨‹å°†ç»“æœä¼ é€’å›æ¥ï¼Œå¦‚æœä½ è¦å°†è¯·æ±‚çš„ç»“æœåšä¸€äº›è€—æ—¶çš„å¤æ‚çš„å¤„ç†ï¼Œå°±ä¼š<em>block</em>ä½ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ä½ å°±éœ€è¦å¯¹è¯·æ±‚çš„Operationä¼ é€’<code>completionQueue</code>å‚æ•°ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AFHTTPRequestOperation *request = [[AFHTTPRequestOperation alloc] initWithRequest:urlrequest];
</span><span class='line'>
</span><span class='line'>request.responseSerializer = [AFJSONResponseSerializer serializer];
</span><span class='line'>//è®¾ç½®å›è°ƒçš„queueï¼Œé»˜è®¤æ˜¯åœ¨mainQueueæ‰§è¡Œblockå›è°ƒ
</span><span class='line'>request.completionQueue = your_request_operation_completion_queue();
</span><span class='line'>[request setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
</span><span class='line'>         //è®¾ç½®äº†'completionQueue'åï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œå¤„ç†å¤æ‚çš„é€»è¾‘
</span><span class='line'>         //ä¸ç”¨æ‹…å¿ƒblockä½äº†ä¸»çº¿ç¨‹
</span><span class='line'>    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
</span><span class='line'>
</span><span class='line'> }];
</span><span class='line'> [request start];
</span></code></pre></td></tr></table></div></figure>


<h3>3ã€å¦‚ä½•çŸ¥é“AFHTTPRequestOperationManageræ‰§è¡Œå®Œæˆ</h3>

<p>å¼€å§‹ä»¥ä¸ºç›´æ¥è®¾ç½®<code>AFHTTPRequestOperationManager</code>çš„<em>completionGroup</em>ï¼Œç„¶ååˆ©ç”¨<code>dispatch_group_notify</code>æ¥è·å–operationQueueæ‰§è¡Œç»“æŸçš„é€šçŸ¥ï¼Œæœ€åæ‰å‘ç°ï¼Œè¿™æ ·æ ¹æœ¬ä¸è¡Œï¼Œçœ‹äº†æºç æ‰çŸ¥é“ï¼š<code>AFHTTPRequestOperationManager</code>ç›´æ¥å°†<em>completionGroup</em>èµ‹å€¼ç»™äº†ä»–çš„æ¯ä¸€ä¸ª<em>operation</em>ï¼Œåœ¨<em>operation</em>çš„completionBlocké‡Œé¢åˆ©ç”¨<em>completionGroup</em>ï¼Œæ¥ç¡®ä¿åœ¨operationçš„å¤„ç†å®Œæˆåï¼Œå°†completionBlockç½®ä¸ºnilï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚</p>

<p>è™½ç„¶è¯´è¿™æ ·ä¸èƒ½çŸ¥é“<code>AFHTTPRequestOperationManager</code>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œæˆï¼Œä½†æ˜¯ç”Ÿæ´»è¿˜å¾—ç»§ç»­ä¸‹å»å•Šï¼åœ¨<code>AFURLConnectionOperation</code>ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å«ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ (NSArray *)batchOfRequestOperations:(NSArray *)operations
</span><span class='line'>                        progressBlock:(void (^)(NSUInteger numberOfFinishedOperations, NSUInteger totalNumberOfOperations))progressBlock
</span><span class='line'>                      completionBlock:(void (^)(NSArray *operations))completionBlock;
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯èƒ½å¤Ÿå‘ä¸€ç»„è¯·æ±‚ï¼Œè·Ÿ<code>AFHTTPRequestOperationManager</code>æ¯”èµ·æ¥çš„ç¼ºç‚¹å°±æ˜¯æ²¡æ³•è®¾ç½®å¹¶å‘æ•°ï¼Œä½†æ˜¯å®ƒå´èƒ½å®ç°æ£€æµ‹ä¸€ç»„è¯·æ±‚ä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œèƒ½æ£€æµ‹å®Œæˆäº†å¤šå°‘è¯·æ±‚ï¼Œå®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p>

<p>åŸæ¥ä»–ä¹Ÿæ˜¯åˆ©ç”¨<strong>dispatch_group_async</strong>å’Œ<strong>dispatch_group_notify</strong></p>

<p>ä¸€èˆ¬çš„æˆ‘ä»¬è¦æŠŠä¸€ä¸ªä»»åŠ¡åŠ å…¥ä¸€ä¸ªgroupé‡Œæ˜¯è¿™æ ·ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_async(group, queue, ^{
</span><span class='line'>    block();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªå†™æ³•ç­‰ä»·äº</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_async(queue, ^{
</span><span class='line'>    dispatch_group_enter(group);
</span><span class='line'>    block()
</span><span class='line'>    dispatch_group_leave(group);
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœè¦æŠŠä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡åŠ å…¥groupï¼Œè¿™æ ·å°±è¡Œä¸é€šäº†ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_async(group, queue, ^{
</span><span class='line'>    [self performBlock:^(){
</span><span class='line'>        block();
</span><span class='line'>    }];
</span><span class='line'>    //æœªæ‰§è¡Œåˆ°block() groupä»»åŠ¡å°±å·²ç»å®Œæˆäº†
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ˜¯å°±éœ€è¦ç”¨åˆ°<code>batchOfRequestOperations</code>é‡Œçš„å®ç°äº†ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_enter(group);
</span><span class='line'>[self performBlock:^(){
</span><span class='line'>    block();
</span><span class='line'>    dispatch_group_leave(group);
</span><span class='line'>}];
</span></code></pre></td></tr></table></div></figure>


<p>å…¶å®è¿™ä¸ªå’Œå¼•ç”¨è®¡æ•°å·®ä¸å¤šï¼Œ<em>dispatch_group_enter</em>æ—¶å¼•ç”¨è®¡æ•°+1ï¼Œ<em>dispatch_group_leave</em>æ—¶å¼•ç”¨è®¡æ•°-1ï¼Œå¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰§è¡Œ<em>dispatch_group_notify</em>çš„å†…å®¹ã€‚å…·ä½“è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AFHTTPRequestOperationManager *downloadManager = [AFHTTPRequestOperationManager manager];
</span><span class='line'>    //è®¾ç½®æœ€å¤§å¹¶å‘æ•°
</span><span class='line'>    [downloadManager.operationQueue setMaxConcurrentOperationCount:([NSProcessInfo processInfo].processorCount) * 2];
</span><span class='line'>    //åˆ›å»ºä¸€ä¸ªgroup
</span><span class='line'>    __block dispatch_group_t group = dispatch_group_create();
</span><span class='line'>    for (NSURL *url in urlArray) {
</span><span class='line'>        NSURLRequest *requestUrl = [NSURLRequest requestWithURL:url];
</span><span class='line'>        AFHTTPRequestOperation *requestOperation = [[AFHTTPRequestOperation alloc] initWithRequest:requestUrl];
</span><span class='line'>        [requestOperation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
</span><span class='line'>            dispatch_group_leave(group);
</span><span class='line'>            
</span><span class='line'>        } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
</span><span class='line'>            dispatch_group_leave(group);
</span><span class='line'>            
</span><span class='line'>        }];
</span><span class='line'>        //å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ä¸­
</span><span class='line'>        [downloadManager.operationQueue addOperation:requestOperation];
</span><span class='line'>        dispatch_group_enter(group);
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    dispatch_group_notify(group, dispatch_get_main_queue(), ^{
</span><span class='line'>        //å…¨éƒ¨è¯·æ±‚å®Œæˆ
</span><span class='line'>        
</span><span class='line'>    });  </span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>4ã€å®ç°æ–­ç‚¹ç»­ä¼ </h3>

<p><code>AFNetworking</code>è™½ç„¶æ”¯æŒæ–‡ä»¶ä¸‹è½½çš„æš‚åœå’Œç»§ç»­ï¼Œä½†æ˜¯å½“ç¼“å­˜æ¸…ç©ºé‡æ–°å¯åŠ¨æ—¶ï¼Œå®ƒå¹¶æ²¡æœ‰è®°å½•ä¸‹ä¸‹è½½çš„çŠ¶æ€ï¼Œæ— æ³•ç»­ä¼ ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<a href="http://https://github.com/steipete/AFDownloadRequestOperation">AFDownloadRequestOperation</a>æ¥ç®€å•çš„å®ç°ï¼Œå…¶å®è¿‡ç¨‹ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¤§è‡´å¦‚ä¸‹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥é˜…è¯»<code>AFDownloadRequestOperation</code>æ˜¯å®ç°éƒ¨åˆ†ï¼š</p>

<p>1ã€è®¾ç½®<code>AFHTTPRequestOperation</code>çš„è¯·æ±‚<code>NSMutableURLRequest</code><em>HTTPHeader</em>çš„<strong>Range</strong>å­—æ®µã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSMutableURLRequest *mutableURLRequest = [self.request mutableCopy];
</span><span class='line'>//offsetæ˜¯æŒ‡æ–­ç‚¹ç»­ä¼ æ–‡ä»¶å·²ç»ä¸‹è½½çš„å¤§å°
</span><span class='line'>[mutableURLRequest setValue:[NSString stringWithFormat:@"bytes=%llu-", offset] forHTTPHeaderField:@"Range"];</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>2ã€è®¾ç½®<code>AFHTTPRequestOperation</code>çš„<em>outputStream</em>å±æ€§ã€‚</p>

<pre><code class="` "> //downloadPathæ˜¯æŒ‡æ–‡ä»¶ä¸‹è½½å­˜æ”¾çš„è·¯å¾„
downloadOperation.outputStream = [NSOutputStream outputStreamToFileAtPath:downloadPath append:YES];
</code></pre>

<h3>ç»“å°¾</h3>

<p>å¯¹äº<code>ASIHTTPRequest</code>å’Œ<code>AFNetworking</code>çš„æ¯”è¾ƒç½‘ä¸Šæœ‰å¾ˆå¤šå¾ˆå¥½çš„æ–‡ç« ï¼Œä¸€æœä¸€å¤§æŠŠï¼Œå¯¹äºæ™®é€šçš„ä½¿ç”¨æ¥è¯´æ„Ÿè§‰åŒºåˆ«ä¸å¤§ï¼Œè¯·æ±‚é€Ÿåº¦ä»€ä¹ˆçš„ä¹Ÿæ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼Œä»¥ä¸Šè‹¥æœ‰é”™è¯¯ï¼Œè¿˜æœ›å¤§å®¶å¤šå¤š
æŒ‡æ­£ğŸ˜ƒã€‚</p>
]]></content>
  </entry>
  
</feed>
