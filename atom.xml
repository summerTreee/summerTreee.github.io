<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[å¤æ ‘æ­£èŒ‚]]></title>
  <link href="http://summertreee.github.io/atom.xml" rel="self"/>
  <link href="http://summertreee.github.io/"/>
  <updated>2015-12-13T17:18:49+08:00</updated>
  <id>http://summertreee.github.io/</id>
  <author>
    <name><![CDATA[æ¢ç‚œV]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ContentCompressionResistanceå’ŒContentHuggingè¯¦è§£]]></title>
    <link href="http://summertreee.github.io/blog/2015/12/13/contentcompressionresistancehe-contenthuggingxiang-jie/"/>
    <updated>2015-12-13T17:07:53+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/12/13/contentcompressionresistancehe-contenthuggingxiang-jie</id>
    <content type="html"><![CDATA[<p>åœ¨Auto Layoutçš„ä½¿ç”¨ä¸­ï¼Œæœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å¸ƒå±€æ¦‚å¿µï¼š<code>Content Compression Resistance</code>å’Œ<code>Content Hugging</code>ï¼Œä»å­—é¢çš„ç¿»è¯‘æˆ‘ä»¬å¤§æ¦‚å¯ä»¥åˆ†åˆ«ç¿»è¯‘ä¸ºï¼š<code>å‹ç¼©é˜»åŠ›</code>ä»¥åŠ<code>å†…å®¹å¸é™„</code>ã€‚ä½†æ˜¯å…‰ä»å­—é¢æ„æ€æ¥ç†è§£å¾ˆéš¾çŸ¥é“å®ƒä»¬å¦‚ä½•ä½¿ç”¨ä»¥åŠç¡®åˆ‡çš„è®¾è®¡æ„å›¾ã€‚æˆ‘æœ€å¼€å§‹ä¹Ÿæ˜¯å¾ˆè¿·ç³Šè€Œä¸”åœ¨ä½¿ç”¨Auto Layoutçš„è¿‡ç¨‹ä¸­ä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿‡å®ƒä»¬ï¼Œç›´åˆ°æœ€è¿‘ç¨ç¨ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå‘ç°å®ƒä»¬çš„ä½œç”¨ç”šæ˜¯å·¨å¤§ï¼Œæ‰€ä»¥æˆ‘ä¸ºäº†åŠ æ·±è®°å¿†ï¼ŒæŠŠæˆ‘æœ€è¿‘å­¦ä¹ åˆ°çš„å…³äºå®ƒä»¬çš„æ¦‚å¿µåœ¨æ­¤ç¨ä½œæ•´ç†åŠ ä»¥è®°å½•ã€‚</p>

<blockquote><p>æ³¨ï¼šä»¥ä¸‹ä¸ºäº†è¡¨è¿°æ–¹ä¾¿ï¼Œå°†<code>Content Compression Resistance</code>è®°ä¸º<code>å‹ç¼©é˜»åŠ›</code>ï¼Œå°†<code>Content Hugging</code>è®°ä¸º<code>å†…å®¹å¸é™„</code>ã€‚</p></blockquote>

<!--more-->


<h4>Content Compression Resistance</h4>

<p><strong>å‹ç¼©é˜»åŠ›</strong>å±æ€§ä¸ºäº†è®°å¿†æ›´åŠ å½¢è±¡æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£ä¸º<strong>ç¦»æˆ‘è¿œç‚¹ï¼Œä¸è®¸æŒ¤åˆ°æˆ‘</strong>ï¼Œå®ƒçš„ä¼˜å…ˆçº§ï¼ˆPriorityï¼‰è¶Šé«˜ï¼Œå®ƒçš„è¿™ç§æŠ—æŒ¤å‹çš„èƒ½åŠ›ä¹Ÿå°±è¶Šå¼ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç åœ¨æ§ä»¶çš„æ°´å¹³æˆ–å‚ç›´æ–¹å‘ä¸Šåˆ†åˆ«è®¾ç½®1ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰åˆ°1000ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ä¹‹é—´çš„ä¼˜å…ˆçº§ï¼Œé»˜è®¤æ˜¯750ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä¸ºä¸€ä¸ª<strong>UILabel</strong>æ§ä»¶è®¾ç½®ä¸€ä¸ªå®ƒåœ¨æ°´å¹³æ–¹å‘ä¸Šä¼˜å…ˆçº§ä¸º<em>500</em>çš„å‹ç¼©é˜»åŠ›ï¼š</p>

<pre><code>[label setContentCompressionResistancePriority:500 forAxis:UILayoutConstraintAxisHorizontal];  
</code></pre>

<p>ç”¨å›¾æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´è¡¨ç¤ºå¦‚ä¸‹ï¼Œè§†å›¾çš„å‹ç¼©é˜»åŠ›å°±å¥½ä¼¼å®ƒè‡ªèº«å¾€å¤–çš„å¼ åŠ›ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè§†å›¾è‡ªå·±ç»´æŒè‡ªèº«æ˜¾ç¤ºå®Œæ•´æ€§çš„èƒ½åŠ›å°±è¶Šå¼ºï¼š</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eyqrwdofkoj208r08r74s.jpg" alt="image" /></p>

<h4>Content Hugging</h4>

<p><strong>å†…å®¹å¸é™„</strong>å±æ€§ä¸ºäº†è®°å¿†æ–¹ä¾¿æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£ä¸º<strong>æŠ±ç´§ï¼ˆHugï¼‰</strong>ï¼Œè§†å›¾çš„å¤§å°ä¸ä¼šéšç€superViewçš„å˜å¤§è€Œæ‰©å¤§ï¼Œè€Œæ˜¯åªç»´æŒèƒ½å®Œå…¨æ˜¾ç¤ºè‡ªå·±å†…å®¹çš„å¤§å°ï¼Œå®ƒçš„è¿™ç§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¸é™„çš„èƒ½åŠ›å°±è¶Šå¼ºï¼Œå’Œ<strong>å‹ç¼©é˜»åŠ›</strong>ä¸€æ ·ï¼Œ<strong>å†…å®¹å¸é™„</strong>çš„ä¼˜å…ˆçº§ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç æ¥è®¾ç½®ï¼Œåªæ˜¯å®ƒçš„é»˜è®¤ä¼˜å…ˆçº§æ˜¯<em>250</em>ï¼š</p>

<pre><code>[label setContentHuggingPriority:251 forAxis:UILayoutConstraintAxisHorizontal];  
</code></pre>

<p>ç”¨å›¾æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´è¡¨ç¤ºå¦‚ä¸‹ï¼Œè§†å›¾çš„å†…å®¹å¸é™„å°±å¥½ä¼¼è§†å›¾è‡ªå·±æœ‰å‘å†…æŠ±ç´§è‡ªå·±çš„åŠ›é‡ä¸€æ ·ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œå®ƒçš„è¿™ç§èƒ½åŠ›å°±è¶Šå¼ºï¼š</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eyqrwdllbej208n08mq3e.jpg" alt="image" /></p>

<p>ä»¥ä¸Šè®²äº†<code>å†…å®¹å¸é™„</code>å’Œ<code>å‹ç¼©é˜»åŠ›</code>çš„åŸºæœ¬æ¦‚å¿µï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå±æ€§æ˜¯å»ºç«‹åœ¨<code>Intrinsic Content Size</code>è¿™ä¸€æ¦‚å¿µä¸Šçš„ï¼Œæˆ‘ä»¬æš‚ä¸”æŠŠå®ƒç¿»è¯‘ä¸º<code>å›ºæœ‰å°ºå¯¸</code>ï¼Œæ‰€æœ‰åŸºäºUIViewçš„è§†å›¾éƒ½æœ‰<code>intrinsicContentSize</code>è¿™ä¸ªå±æ€§ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>å›ºæœ‰å°ºå¯¸</code>ã€‚</p>

<h4>Intrinsic Content Size</h4>

<p>æ¯ä¸ªè§†å›¾éƒ½æœ‰å‹ç¼©é˜»åŠ›ä¼˜å…ˆçº§ï¼ˆContent Compression Resistance Priorityï¼‰å’Œå†…å®¹å¸é™„ä¼˜å…ˆçº§ï¼ˆContent Hugging Priorityï¼‰ï¼Œä½†åªæœ‰è§†å›¾æ˜ç¡®äº†å®ƒçš„<code>å›ºæœ‰å°ºå¯¸</code>åï¼Œè¿™ä¸¤ç§ä¼˜å…ˆçº§æ‰ä¼šèµ·ä½œç”¨ã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å®˜æ–¹çš„è§£é‡Šï¼š</p>

<blockquote><p> Custom views typically have content that they display of which the layout system is unaware. Overriding this method allows a custom view to communicate to the layout system what size it would like to be based on its content. This intrinsic size must be independent of the content frame, because thereâ€™s no way to dynamically communicate a changed width to the layout system based on a changed height, for example.
If a custom view has no intrinsic size for a given dimension, it can return UIViewNoIntrinsicMetric for that dimension.</p></blockquote>

<p>å¤§è‡´çš„æ„æ€å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„è§†å›¾åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒçš„å›ºæœ‰å°ºå¯¸æ˜¯è¿”å›(UIViewNoIntrinsicMetricï¼ŒUIViewNoIntrinsicMetric)ï¼Œä¹Ÿå°±æ˜¯(-1,-1)ï¼Œåªæœ‰æˆ‘ä»¬æ ¹æ®è‡ªå®šä¹‰è§†å›¾æœ¬èº«çš„Contentæ¥é‡å†™è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„è§†å›¾æ‰èƒ½æ˜ç¡®çš„çŸ¥é“ä»–åœ¨æ˜¾ç¤ºç³»ç»Ÿä¸­è¯¥å±•ç¤ºçš„å¤§å°ã€‚<br/>
UILabelå’ŒUIButtonç­‰è¿™äº›æ§ä»¶ï¼Œç³»ç»Ÿé»˜è®¤æ˜¯æ ¹æ®ä»–ä»¬çš„å†…å®¹å®ç°äº†å›ºæœ‰å°ºå¯¸ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦ç¡®å®šoriginæˆ–è€…Centerå®ƒä»¬å°±èƒ½æ­£ç¡®çš„æ˜¾ç¤ºã€‚<br/>
ç”±æ­¤å¯è§ï¼Œå›ºæœ‰å°ºå¯¸æ˜¯ä¸ºäº†å®ç°è§†å›¾çš„<strong>å¤§å°è‡ªé€‚åº”</strong>è€Œå­˜åœ¨çš„ã€‚</p>

<p>ä»¥ä¸‹æˆ‘æ¥è‡ªå®šä¹‰ä¸€ä¸ªè§†å›¾ï¼Œæ¥æµ‹è¯•ä¸€ä¸‹<code>å›ºæœ‰å°ºå¯¸</code>æ˜¯å¦æœ‰æ•ˆï¼Œç”±äºé¡¹ç›®ä¸­å¤§å®¶éƒ½æ˜¯ç”¨<a href="http://https://github.com/SnapKit/Masonry">Masonry</a>æ¥å¤„ç†Auto Layoutï¼Œæ‰€ä»¥ä¸€ä¸‹çš„ä¾‹å­éƒ½ä½¿ç”¨<code>Masonry</code>æ¥å¸ƒå±€ã€‚</p>

<h5>é‡å†™Intrinsic Content Size</h5>

<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ª<code>UIView</code>çš„è‡ªå®šä¹‰è§†å›¾<code>IntrinsicView</code>ï¼Œåœ¨ä¸€ä¸ªViewControllerä¸­æ·»åŠ ä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„è§†å›¾,è®¾ç½®å®ƒæ°´å¹³å±…ä¸­ï¼Œé¡¶éƒ¨å’Œçˆ¶è§†å›¾å¯¹é½ã€‚</p>

<pre><code>- (void)layoutSubIntrinsicView
{
    IntrinsicView *intrinsicView = [IntrinsicView new];
    intrinsicView.backgroundColor = [UIColor colorWithRed:.2 green:.4 blue:.6 alpha:1];
    [self.view addSubview:intrinsicView];
    [intrinsicView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.centerX.mas_equalTo(self.view);
    make.top.mas_equalTo(self.mas_topLayoutGuideBottom);
}];
}
</code></pre>

<p>è¿è¡Œåå‘ç°ä»€ä¹ˆä¹Ÿæ²¡æ˜¾ç¤ºï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®å®ƒçš„å®½é«˜ï¼Œè€Œå®ƒé»˜è®¤çš„å›ºæœ‰å°ºå¯¸æ˜¯ï¼ˆ-1 ï¼Œ-1ï¼‰ã€‚æˆ‘ä»¬å»é‡å†™<code>IntrinsicView</code>çš„<code>- (CGSize)intrinsicContentSize</code>æ–¹æ³•ï¼š</p>

<pre><code>@implementation IntrinsicView

- (CGSize)intrinsicContentSize
{
    return CGSizeMake(150, 66);
}

@end  
</code></pre>

<p>è¿è¡Œåæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww2.sinaimg.cn/mw690/8f7a6fe0jw1eyqrw65tsuj208y0ddaa5.jpg" alt="image" /></p>

<p>æ˜¾ç¤ºå‡ºæ¥ï¼Œå®ƒçš„å¤§å°åˆšå¥½æ˜¯æˆ‘ä»¬å®šä¹‰çš„<code>intrinsicContentSize</code>å¤§å°ã€‚ä¸Šé¢ä»‹ç»äº†å†…å®¹å¸é™„å’Œå‹ç¼©é˜»åŠ›ä»¥åŠå›ºæœ‰å°ºå¯¸çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸‹é¢æ¥æµ‹è¯•ä¸€ä¸‹å®ƒä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p>

<h6>1ã€æµ‹è¯•å†…å®¹å¸é™„ä¼˜å…ˆçº§</h6>

<p>ä¸ºäº†æµ‹è¯•å†…å®¹å¸é™„ä¼˜å…ˆçº§æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ·»åŠ ä¸¤ä¸ª<code>IntrinsicView</code>ï¼Œåˆ†åˆ«æ˜¯<code>topView</code>å’Œ<code>bottomView</code>ï¼Œè®¾ç½®ä»–ä»¬éƒ½æ°´å¹³å±…ä¸­ï¼Œç„¶ååˆ†åˆ«å’Œé¡µé¢çš„é¡¶éƒ¨å’Œåº•éƒ¨å¯¹é½ï¼š</p>

<pre><code>- (void)layoutSubIntrinsicView
{
    IntrinsicView *topView = [IntrinsicView new];
    topView.backgroundColor = [UIColor colorWithRed:.2 green:.4 blue:.6 alpha:1];
    [self.view addSubview:topView];
    [topView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self.view);
        make.top.mas_equalTo(self.mas_topLayoutGuideBottom);//å’Œå¯¼èˆªæ åº•éƒ¨å¯¹é½
    }];

    IntrinsicView *bottomView = [IntrinsicView new];
    bottomView.backgroundColor = [UIColor colorWithRed:.2 green:.4 blue:.6 alpha:1];
    [self.view addSubview:bottomView];
    [bottomView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self.view);
        make.bottom.mas_equalTo(self.mas_bottomLayoutGuideBottom);//å’Œé¡µé¢åº•éƒ¨å¯¹é½
    }];
}  
</code></pre>

<p>è¿è¡Œåå±•ç¤ºå¦‚ä¸‹ï¼š<br/>
<img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0jw1eyqrw6ih8aj208w0ddglq.jpg" alt="image" /></p>

<p>ä¸‹é¢æˆ‘ä»¬è®¾ç½®<strong>topView</strong>å’Œ<strong>bottomView</strong>ä¹‹é—´çš„é—´è·ä¸º<em>40</em>ï¼Œä¹Ÿå°±æ˜¯<code>topView.bottom + 40 = bottomView.top</code>ã€‚</p>

<pre><code>- (void)layoutSubIntrinsicView
{
    IntrinsicView *topView = [IntrinsicView new];
    topView.backgroundColor = [UIColor colorWithRed:.2 green:.4 blue:.6 alpha:1];
    [self.view addSubview:topView];
    [topView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self.view);
        make.top.mas_equalTo(self.mas_topLayoutGuideBottom);//å’Œå¯¼èˆªæ åº•éƒ¨å¯¹é½
}];

    IntrinsicView *bottomView = [IntrinsicView new];
    bottomView.backgroundColor = [UIColor colorWithRed:.2 green:.4 blue:.6 alpha:1];
    [self.view addSubview:bottomView];
    [bottomView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self.view);
        make.top.mas_equalTo(topView.mas_bottom).offset(40);
        make.bottom.mas_equalTo(self.mas_bottomLayoutGuideBottom);//å’Œé¡µé¢åº•éƒ¨å¯¹é½
 }];
}  
</code></pre>

<p>è¿è¡Œåå±•ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eyqrw6xva7j208v0dcmxb.jpg" alt="image" /></p>

<p>æˆ‘ä»¬å‘ç°<code>topView</code>è¢«æ‹‰ä¼¸äº†ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³<code>topView</code>è¢«æ‹‰ä¼¸ï¼Œå°±å¯ä»¥åˆ©ç”¨<code>å†…å®¹å¸é™„</code>çš„ç‰¹æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å®šä¹‰äº†<code>IntrinsicView</code>çš„å›ºæœ‰å°ºå¯¸ï¼Œè®¾ç½®<code>topView</code>çš„<code>å†…å®¹å¸é™„</code>ä¼˜å…ˆçº§æ¯”<code>bottomView</code>çš„ä¼˜å…ˆçº§é«˜ï¼Œæˆ‘ä»¬ä¸Šé¢ä»‹ç»äº†<code>å†…å®¹å¸é™„</code>çš„é»˜è®¤ä¼˜å…ˆçº§æ˜¯<em>250</em>ï¼Œæˆ‘ä»¬æŠŠ<code>topView</code>çš„<code>å†…å®¹å¸é™„</code>ä¼˜å…ˆçº§è®¾ç½®ä¸º<em>251</em>ï¼Œåœ¨åŸæ¥<code>layoutSubIntrinsicView</code>å‡½æ•°çš„æœ€åæ·»åŠ å¦‚ä¸‹è¯­å¥ï¼š</p>

<pre><code>[topView setContentHuggingPriority:251 forAxis:UILayoutConstraintAxisVertical];  
</code></pre>

<p>è¿è¡Œåå¦‚ä¸‹æ‰€ç¤ºï¼Œè¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼š</p>

<p><img src="http://ww2.sinaimg.cn/mw690/8f7a6fe0jw1eyqrw7a0tqj208w0ddt8v.jpg" alt="image" /></p>

<blockquote><p>251æ˜¯æˆ‘éšæ„å®šçš„æ¯”250å¤§çš„å€¼ï¼Œå¯ä»¥æ˜¯å¤§äº250å°äº1000çš„ä»»ä½•å€¼ã€‚</p></blockquote>

<h6>2ã€æµ‹è¯•å‹ç¼©é˜»åŠ›ä¼˜å…ˆçº§</h6>

<p>æˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„éœ€æ±‚ï¼š</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eyqrw7yw9hj20e007cdgi.jpg" alt="image" /></p>

<p>åœ¨æŸä¸ªé¡µé¢ä¸Šæ°´å¹³æ”¾ç½®ä¸¤ä¸ªUILabelï¼Œ<code>leftLabel</code>çš„å·¦è¾¹å’Œçˆ¶è§†å›¾çš„é—´è·å›ºå®šï¼Œ<code>rightLabel</code>çš„å³è¾¹å’Œçˆ¶è§†å›¾çš„å³è¾¹æœ‰ä¸€ä¸ªå°äºç­‰äºæŸä¸ªé—´éš”çš„çº¦æŸï¼Œ<code>leftLabel</code>å’Œ<code>rightLabel</code>ä¹‹é—´æœ‰ä¸€ä¸ªå›ºå®šé—´è·ï¼Œå®ƒä»¬çš„å®½åº¦æ ¹æ®ä»–ä»¬æ˜¾ç¤ºçš„å†…å®¹è‡ªé€‚åº”ï¼Œå…³é”®ä»£ç å¦‚ä¸‹:</p>

<pre><code>[leftLabel mas_makeConstraints:^(MASConstraintMaker *make) {
    //å·¦è¾¹å’Œçˆ¶è§†å›¾é—´éš”å›ºå®šä¸º10
    make.left.mas_equalTo(self.view).offset(10);
    make.top.mas_equalTo(80);//éšæ„è®¾å®šçš„å€¼
}];

[rightLabel mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.mas_equalTo(leftLabel);
    //å’ŒleftLabelçš„å³è¾¹é—´è·å›ºå®šä¸º20
    make.left.mas_equalTo(leftLabel.mas_right).offset(20);
    //è¿™é‡Œæ³¨æ„æ˜¯â€˜lessThanOrEqualToâ€™ï¼Œä¹Ÿå°±æ˜¯â€˜rightLabelâ€™çš„å³è¾¹ç•Œ
    //å’Œçˆ¶è§†å›¾çš„é—´è·è‡³å°‘ä¸º10ï¼Œå†…å®¹å°‘æ—¶ï¼Œé—´è·è‡ªåŠ¨è°ƒå¤§
    make.right.mas_lessThanOrEqualTo(self.view).offset(-10);
}];  
</code></pre>

<p>åœ¨ä»–ä»¬çš„æ˜¾ç¤ºå†…å®¹å®½åº¦ä¸è¶…è¿‡çˆ¶è§†å›¾å®½åº¦æ—¶ï¼Œä¸¤ä¸ªlabelçš„å†…å®¹éƒ½èƒ½æ­£å¸¸çš„å®Œå…¨æ˜¾ç¤ºï¼Œä½†æ˜¯å½“å®ƒä»¬éœ€è¦æ˜¾ç¤ºçš„å†…å®¹é•¿åº¦æ€»å’Œè¶…è¿‡çˆ¶è§†å›¾çš„å®½åº¦æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eyqrwckaf2j208x0ddglw.jpg" alt="image" /></p>

<p>ä¸€ä¸ªlabelè¢«å‹ç¼©äº†ï¼Œ <code>rightLabel</code>æ˜¾ç¤ºä¸å®Œå…¨ï¼Œå¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³<code>leftLabel</code>è¢«å‹ç¼©ï¼Œè€Œ<code>rightLabel</code>å°½é‡å®Œå…¨æ˜¾ç¤ºï¼Œç”±äºUILabelè¿™ç±»æ§ä»¶ï¼Œç³»ç»Ÿè‡ªå·±å·²ç»æ ¹æ®å®ƒä»¬æ˜¾ç¤ºçš„å®é™…å†…å®¹å®ç°äº†<code>å›ºæœ‰å°ºå¯¸</code>çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>å‹ç¼©é˜»åŠ›</code>çš„ç‰¹æ€§ï¼Œå°†<code>rightLabel</code>çš„<code>å‹ç¼©é˜»åŠ›</code>ä¼˜å…ˆçº§è®¾ç½®å¾—æ¯”<code>leftLabel</code>é«˜ï¼Œä¸Šé¢ä»‹ç»äº†<code>å‹ç¼©é˜»åŠ›</code>çš„é»˜è®¤ä¼˜å…ˆçº§æ˜¯<em>750</em>ï¼Œæˆ‘ä»¬æŠŠ<code>rightLabel</code>çš„ä¼˜å…ˆçº§è®¾ç½®ä¸º<em>751</em>ï¼Œåœ¨ä¸Šé¢ä»£ç çš„æœ€ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>

<pre><code>[rightLabel setContentCompressionResistancePriority:751 forAxis:UILayoutConstraintAxisHorizontal];  
</code></pre>

<p>è¿è¡Œåæ˜¾ç¤ºå¦‚ä¸‹ï¼Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœï¼š</p>

<p><img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0jw1eyqrwd0cbqj208x0dddg4.jpg" alt="image" /></p>

<h6>3ã€åœ¨è‡ªåŠ¨è®¡ç®—UITableViewCellé«˜åº¦ä¸­çš„ä½¿ç”¨</h6>

<p>å¯¹äºå˜é«˜cellçš„å¤„ç†ï¼Œä»¥å‰æˆ‘ä»¬éƒ½æ˜¯åœ¨<code>heightForRowAtIndexPath</code>æ–¹æ³•é‡Œé¢ï¼Œæ‹¼å‡‘è¦å±•ç¤ºçš„å˜é«˜cellçš„é«˜åº¦ï¼Œå½“æˆ‘ä»¬æ”¹å˜cellä¸­ä¸¤ä¸ªæ§ä»¶åœ¨å‚ç›´æ–¹å‘çš„å¸ƒå±€ï¼Œæˆ–è€…å†æ·»åŠ ä¸€ä¸ªæ§ä»¶æ—¶ï¼Œè¿˜è¦å»ä¿®æ”¹è®¡ç®—cellé«˜åº¦çš„æ–¹æ³•æ¥é€‚åº”æ–°çš„å˜åŒ–ï¼Œéå¸¸ä¸æ–¹ä¾¿ã€‚ä½†æ˜¯æœ‰äº†è‡ªåŠ¨å¸ƒå±€åï¼Œåˆ©ç”¨å¥½<code>å‹ç¼©é˜»åŠ›</code>å’Œ<code>å†…å®¹å¸é™„</code>çš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥å¾ˆç²¾ç¡®å¾ˆç®€å•çš„ç”±ç³»ç»Ÿæ¥è®¡ç®—å‡ºå˜é«˜cellçš„é«˜åº¦ã€‚</p>

<p>å‡å®šæˆ‘ä»¬æœ‰å¦‚ä¸‹éœ€æ±‚ï¼š<br/>
<img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0gw1eyvfxt9hqfj20e1097dgw.jpg" alt="image" /></p>

<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªå˜é«˜cellé‡Œé¢é«˜åº¦ä¸å®šçš„æ˜¯ä¸­é—´çš„<code>ContentLabel</code>ï¼Œå®ƒä¼šæ ¹æ®å†…å®¹é•¿åº¦æ¥æŠ˜è¡Œæ˜¾ç¤ºï¼Œ<strong>UILabel</strong>è¦æŠ˜è¡Œæ˜¾ç¤ºæˆ‘ä»¬éœ€è¦è®¾ç½®å®ƒçš„<code>preferredMaxLayoutWidth</code>å’Œ<code>numberOfLines</code>ä¸¤ä¸ªå±æ€§çš„å€¼ã€‚</p>

<p>é¦–å…ˆå‡å®š<code>Model</code>çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>@interface CellModel : NSObject

@property (nonatomic, copy) NSString *name;
@property (nonatomic, copy) NSString *company;
@property (nonatomic, copy) NSString *content;
@property (nonatomic, assign) CGFloat cacheHeight;//ç¼“å­˜å½“å‰Modelæ˜¾ç¤ºçš„cellé«˜åº¦

@end
</code></pre>

<p>è‡ªå®šä¹‰çš„<code>UITableViewCell</code>çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>//å›¾ç‰‡è·å·¦è¾¹è·ç¦»ä¸º10ï¼Œä¸Šä¸‹å±…ä¸­
    [_cellImageView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.contentView).offset(10);
        make.centerY.mas_equalTo(self.contentView);
        make.top.mas_greaterThanOrEqualTo(self.contentView).offset(10);
        make.bottom.mas_lessThanOrEqualTo(self.contentView).offset(-10);
    }];
    //æ ‡é¢˜Label,ä¸€è¡Œæ˜¾ç¤º
    [_nameLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.cellImageView.mas_right).offset(6);
        make.right.mas_lessThanOrEqualTo(self.contentView).offset(-10);
        make.top.mas_equalTo(self.contentView).offset(10);
    }];
    //å†…å®¹label,å¤šè¡Œæ˜¾ç¤º
    _contentLabel.numberOfLines = 0;
    [self.contentView addSubview:_contentLabel];
    [_contentLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.nameLabel);
        make.top.mas_equalTo(self.nameLabel.mas_bottom).offset(6);
    }];
    //æ ‡é¢˜Label,ä¸€è¡Œæ˜¾ç¤º
    [_companyLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.contentLabel);
        make.right.mas_lessThanOrEqualTo(self.contentView).offset(-10);
        make.top.mas_equalTo(self.contentLabel.mas_bottom).offset(6);
        make.bottom.mas_equalTo(self.contentView).offset(-10);//è®¾å®šäº†è¿™ä¸ªè‡ªåŠ¨è®¡ç®—cellé«˜åº¦æ—¶æ‰çŸ¥é“å…·ä½“cellçš„é«˜åº¦
    }];

    [_nameLabel setContentHuggingPriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisVertical];
    [_companyLabel setContentHuggingPriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisVertical];
    [_contentLabel setContentHuggingPriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisVertical];  
</code></pre>

<p>ä¸Šé¢çš„ä»£ç ä¸­è®¾ç½®äº†å‡ ä¸ª<code>UILabel</code>çš„<code>å†…å®¹å¸é™„</code>ä¼˜å…ˆçº§ä¸ºæœ€é«˜ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šéšç€cellé«˜åº¦çš„å˜åŒ–è€Œæ‹‰ä¼¸é«˜åº¦ã€‚ä¸Šé¢è®¾ç½®äº†<code>contentLabel</code>çš„<code>numberOfLines = 0</code>ï¼Œè¿˜éœ€è¦è®¾ç½®<code>preferredMaxLayoutWidth</code>æ‰èƒ½æ­£ç¡®æ¢è¡Œæ˜¾ç¤ºã€‚ç”±äº<code>UITableViewCell</code>åœ¨æ˜¾ç¤ºå‡ºæ¥ä¹‹å‰æ˜¯ä¸çŸ¥é“å®½åº¦çš„ï¼Œä½†æ˜¯ä¸ºäº†è·å–æ­£ç¡®çš„å®½åº¦æˆ‘ä»¬å¯ä»¥åœ¨<code>- (void)layoutSubviews</code>æ–¹æ³•é‡Œé¢è®¾ç½®ï¼š</p>

<pre><code>- (void)layoutSubviews
{
    _contentLabel.preferredMaxLayoutWidth = CGRectGetWidth(self.contentView.frame) - 128 - 10 - 6;//åé¢çš„æ•°å­—æ˜¯å‰åä»¥åŠå›¾ç‰‡çš„å®½åº¦
    [super layoutSubviews];//è¿™ä¸ªè°ƒç”¨æ˜¯ä¸ºäº†æ”¹å˜åæ›´æ–°å¸ƒå±€
}
</code></pre>

<p>è¿™æ ·æˆ‘ä»¬è®¾ç½®å¥½cellä»¥åŠModelä»¥åï¼Œå…¶ä»–çš„æ–¹æ³•éƒ½å’Œæ™®é€šçš„ä½¿ç”¨ä¸€æ ·ï¼Œå”¯ä¸€ä¸ä¸€æ ·çš„å°±æ˜¯è®¡ç®—cellé«˜åº¦çš„<code>UITableView</code>ä»£ç†æ–¹æ³•<code>heightForRowAtIndexPath</code>ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹ï¼š</p>

<pre><code>- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static CodeLayoutCell *singleCell = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
    //è¿™é‡ŒæŒæœ‰ä¸€ä¸ªcellæ˜¯ä¸ºäº†ä¸‹é¢è‡ªåŠ¨è®¡ç®—cellé«˜åº¦çš„éœ€è¦
        singleCell = [tableView dequeueReusableCellWithIdentifier:kCellIdentifier];
    });
    //å–å‡ºModelï¼Œå¦‚æœæœ‰ç¼“å­˜çš„é«˜åº¦å€¼å°±ä¸è®¡ç®—äº†
    CellModel *model = _dataSourceArray[indexPath.row];
    if (model.cacheHeight != 0) {
        return model.cacheHeight;
    }
    [singleCell layoutIfNeeded];//å¼ºåˆ¶å¸ƒå±€ï¼Œå¾—åˆ°contentViewçš„å®½åº¦
    [singleCell setNewCellModel:model];
    //ç”±ç³»ç»Ÿæ ¹æ®æˆ‘ä»¬è®¾å®šçš„Layoutè§„åˆ™æ¥è®¡ç®—cellæ˜¾ç¤ºçš„Size
    CGSize size = [singleCell.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize];
    model.cacheHeight = size.height + 1;//cellå’Œcell.contentViewçš„é«˜åº¦ç›¸å·®1

    return model.cacheHeight;
}  
</code></pre>

<p>è¿è¡Œçš„æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0gw1eyvfxuuzclg208u0d51kx.gif" alt="image" /></p>

<p>å½“å›¾ç‰‡çš„é«˜åº¦å¤§äºä¸‰ä¸ª<code>UIlabel</code>åŠ ä¸Šå„è‡ªä¸Šä¸‹çš„é—´éš”çš„é«˜åº¦æ—¶ï¼Œç”±äºæˆ‘ä»¬è®¾ç½®äº†ä¸‰ä¸ªLabelçš„<code>å†…å®¹å¸é™„</code>æœ€é«˜çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ä¸ºäº†æ»¡è¶³å®ƒä»¬çš„é«˜åº¦ï¼Œå›¾ç‰‡çš„å†…å®¹å°±è¿›è¡Œäº†å‹ç¼©ï¼Œå¦‚ä¸‹:</p>

<p><img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0gw1eyvfxtyebuj208w0dbdhk.jpg" alt="image" /></p>

<p>ç¬¬äºŒä¸ªcellçš„å›¾ç‰‡è¢«å‹ç¼©äº†ï¼Œå¦‚ä½•æ‰èƒ½ä¿è¯å®ƒä¸è¢«å‹ç¼©å‘¢ï¼Ÿç•™ç»™è¯»åˆ°è¿™é‡Œçš„äººè‡ªå·±å®ç°å§ï¼ğŸ˜„</p>

<p>æš‚æ—¶å…ˆå†™åˆ°è¿™é‡Œå§ï¼Œç”±äºåˆšæ¥è§¦è¿™ä¸¤ä¸ªå±æ€§ï¼Œéš¾å…ä¼šæœ‰é—è¯¯ä¹‹å¤„ï¼Œè¯·å¤§å®¶å¤šå¤šè°…è§£ï¼</p>

<p>å®Œæ•´çš„Demoï¼Œè¯·æˆ³<a href="https://github.com/liangwei518/AutolayoutDemo1">è¿™é‡Œ</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Auto Layoutä½¿ç”¨å°æŠ€å·§]]></title>
    <link href="http://summertreee.github.io/blog/2015/11/22/auto-layoutshi-yong-xiao-ji-qiao/"/>
    <updated>2015-11-22T22:58:51+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/11/22/auto-layoutshi-yong-xiao-ji-qiao</id>
    <content type="html"><![CDATA[<p>ç›®å‰ç”±äºAppleè‡ªå·±çš„Auto Layoutå†™æ³•æ¯”è¾ƒå•°å—¦ï¼Œæ‰€ä»¥å‡ºç°äº†è®¸å¤šå¯¹åŸç”Ÿè¯­å¥è¿›è¡Œå°è£…çš„ç¬¬ä¸‰æ–¹å¼€å‘åº“ï¼Œè¿™å…¶ä¸­<code>Masonry</code>å¹¿å—å¼€å‘è€…çš„å–œçˆ±ï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½ä»¥<code>Masonry</code>æ¥åšæ¼”ç¤ºè¯´æ˜ï¼Œä½†å¯¹äºAppleåŸç”Ÿçš„å†™æ³•ä¹ŸåŒæ ·é€‚ç”¨ã€‚</p>

<h3>1ã€å›¾ç‰‡+æ–‡å­—å±…ä¸­æ˜¾ç¤º</h3>

<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šä¸€å¼ å›¾ç‰‡æ—è¾¹æ¥ä¸Šä¸€æ®µæ–‡å­—ï¼Œç„¶åè®©ä»–ä»¬ç›¸å¯¹äºçˆ¶è§†å›¾å±…ä¸­æ˜¾ç¤ºï¼Œä»¥å‰æˆ‘çš„åšæ³•æ˜¯å…ˆçŸ¥é“å›¾ç‰‡çš„å°ºå¯¸ï¼Œç„¶åæ¥è®¡ç®—ä»–ä»¬ç›¸å¯¹äºçˆ¶è§†å›¾ä¸­å¿ƒçš„åç§»é‡ï¼Œå†è¿›è¡Œå¸ƒå±€ã€‚éœ€æ±‚çš„æ ·å¼å¤§è‡´å¦‚ä¸‹ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0jw1eya4nyp8qbj208w014a9v.jpg" alt="å¤§è‡´æ•ˆæœ" /></p>

<p>ä½†æ˜¯è¿™æ ·çš„ç¼ºç‚¹æ˜¯æ¯æ¬¡éƒ½éœ€è¦å»æ®ç®—è·ç¦»ä¸­å¿ƒçš„åç§»é‡ï¼Œå¾ˆéº»çƒ¦ï¼Œå¯¹äºè¿™ç§æƒ…å†µå…¶å®å¯ä»¥æ·»åŠ ä¸€ä¸ªè¾…åŠ©è§†å›¾ï¼Œè®©è¿™ä¸ªè¾…åŠ©è§†å›¾çš„å·¦è¾¹ç­‰äºå›¾ç‰‡çš„å·¦è¾¹ï¼Œå³è¾¹å’Œæ–‡å­—çš„å³è¾¹å¯¹é½ï¼Œç„¶åè¿™ä¸ªè¾…åŠ©è§†å›¾ç›¸å¯¹äºçˆ¶è§†å›¾å±…ä¸­æ˜¾ç¤ºå°±è¡Œã€‚</p>

<!--more-->


<pre><code>- (void)layoutImageAndText {
UIImageView *imageView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"av_colum"]];
[self.view addSubview:imageView];
[imageView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.equalTo(@10);
    make.left.greaterThanOrEqualTo(self.view);
}];

UILabel *label = [UILabel new];
label.text = @"æ¢æœä¼Ÿ";
label.font = [UIFont systemFontOfSize:17];
label.textAlignment = NSTextAlignmentLeft;
label.backgroundColor = [UIColor clearColor];
[self.view addSubview:label];
[label mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.equalTo(imageView.mas_right).offset(5);
    make.centerY.equalTo(imageView);
}];

UIView *limitView = [UIView new];
[self.view addSubview:limitView];
[limitView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.equalTo(imageView);//å’Œå›¾ç‰‡å·¦è¾¹å¯¹é½
    make.right.equalTo(label);//å’Œæ–‡å­—å³è¾¹å¯¹é½
    make.centerX.equalTo(self.view);//æŒ‡å®šlimitViewå±…ä¸­æ˜¾ç¤º
}];
}
</code></pre>

<h3>2ã€å¤„ç†å¤åˆå‹å¸ƒå±€</h3>

<p>ç›´æ¥ä¸Šå›¾è¯´æ˜éœ€æ±‚ï¼Œé¡µé¢ä¸Šæœ‰å››ä¸ªå¯è§çš„è§†å›¾ï¼šçº¢ã€ç»¿ã€è“ä¸‰ä¸ª<code>UIView</code>ï¼Œæœ€ä¸‹é¢æ˜¯ä¸€ä¸ª<code>UIButton</code>,æƒ³è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯ç‚¹å‡»buttonè§¦å‘äº‹ä»¶å°†ä¸­é—´çš„ç»¿è‰²è§†å›¾éšè—ï¼Œä¸‹é¢çš„è“è‰²è§†å›¾å’Œbuttonç§»åŠ¨åˆ°çº¢è‰²è§†å›¾ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0jw1eya4nz1i8hg208p0bjmxi.gif" alt="éœ€è¦çš„æ•ˆæœ" /></p>

<p>å¦‚æœåªæ˜¯å°†ä¸­é—´çš„ç»¿è‰²çš„è§†å›¾hiddenæ‰ï¼Œæ˜¯è¾¾ä¸åˆ°è¿™æ ·çš„æ•ˆæœçš„ï¼š</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eya4nza0mfj208w0a8748.jpg" alt="å½±è—ä¸­é—´çš„ç»¿è‰²è§†å›¾" /></p>

<p>è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœå¯ä»¥åˆ©ç”¨<code>MASConstraint</code>çš„<code>deactivate</code>å’Œ<code>activate</code>æ–¹æ³•ï¼Œä»–ä»¬çš„ä½œç”¨æ˜¯è®©ä¸€ä¸ªconstraint<strong>ä¸ç”Ÿæ•ˆ</strong>å’Œ<strong>ç”Ÿæ•ˆ</strong>ï¼Œ<code>Masonry</code>çš„æ¯ä¸ªConstraintéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª<code>MASConstraint</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿å­˜ä¸€äº›éœ€è¦æ”¹å˜çš„constraintï¼Œåœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>

<pre><code>//.h
@interface ViewController ()

@property (nonatomic, strong) UIView *greenView;
@property (nonatomic, strong) MASConstraint *gHeightConstraint;//ä¿å­˜å…³é”®çš„constraint

@end
//.m
@implementation ViewController

- (void)testComplexLayout {
NSNumber *viewHeight = @80;
UIView *redView = [UIView new];
redView.backgroundColor = [UIColor redColor];
[self.view addSubview:redView];
[redView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.left.right.equalTo(self.view);
    make.height.equalTo(viewHeight);
}];

_greenView = [UIView new];
[self.view addSubview:_greenView];
[_greenView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.right.equalTo(redView);
    make.top.equalTo(redView.mas_bottom);
    self.gHeightConstraint = make.height.equalTo(@0).priorityHigh();//è®¾ä¸ºé«˜ä¼˜å…ˆçº§ï¼Œé¦–å…ˆæ»¡è¶³å®ƒçš„éœ€æ±‚
}];
[self.gHeightConstraint deactivate];//æœ€å¼€å§‹è®©å®ƒä¸ç”Ÿæ•ˆï¼Œå°±æ˜¯é«˜ä¸º0çš„é™åˆ¶æš‚ä¸ç”Ÿæ•ˆ
_greenView.clipsToBounds = YES;//ä¸æ˜¾ç¤ºè¶…è¿‡boundsæœ¬èº«çš„éƒ¨åˆ†ï¼Œå› ä¸ºåœ¨å®ƒé‡Œé¢åŠ äº†subView
//subGreenViewæ˜¯çœŸå®çš„æ˜¾ç¤ºç»¿è‰²éƒ¨åˆ†ï¼Œå®ƒæ·»åŠ åœ¨greenViewä¸Š
UIView *subGreenView = [UIView new];
subGreenView.backgroundColor = [UIColor greenColor];
[_greenView addSubview:subGreenView];
[subGreenView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.edges.equalTo(self.greenView).priorityLow();
    make.height.equalTo(viewHeight);
}];

UIView *blueView = [UIView new];
blueView.backgroundColor = [UIColor blueColor];
[self.view addSubview:blueView];
[blueView mas_makeConstraints:^(MASConstraintMaker *make) {
    make.height.left.right.equalTo(redView);
    make.top.equalTo(self.greenView.mas_bottom);
}];

UIButton *hiddenButton = [UIButton buttonWithType:UIButtonTypeCustom];
[hiddenButton setTitle:@"å½±è—ä¸­é—´çš„View" forState:UIControlStateNormal];
[hiddenButton addTarget:self action:@selector(hiddenAction:) forControlEvents:UIControlEventTouchUpInside];
[hiddenButton setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
[self.view addSubview:hiddenButton];
[hiddenButton mas_makeConstraints:^(MASConstraintMaker *make) {
    make.centerX.equalTo(self.view);
    make.top.equalTo(blueView.mas_bottom).offset(40);
}];
}

static bool isActive = NO;
- (void)hiddenAction:(id)sender {
if (isActive) {
    [_gHeightConstraint deactivate];
} else {
    [_gHeightConstraint activate];
}
//åŠ¨ç”»å±•ç¤º
[UIView animateWithDuration:.25 animations:^{
    [self.view layoutIfNeeded];
}];

isActive = !isActive;
}
</code></pre>

<h3>3ã€Previewçš„ä½¿ç”¨</h3>

<p>è¿™æ®µæ—¶é—´åœ¨å­¦ä¹ storyBoardç›¸å…³çš„ä¸€äº›çŸ¥è¯†ï¼ŒRWä¸Šçš„ä¸¤ç¯‡æ–‡ç« ï¼š<a href="http://www.raywenderlich.com/50308/storyboards-tutorial-in-ios-7-part-1">Part1</a>å’Œ<a href="http://www.raywenderlich.com/50310/storyboards-tutorial-in-ios-7-part-2">Part2</a>éå¸¸é€‚åˆåˆå­¦è€…å­¦ä¹ ï¼Œå·²ç»æœ‰äººç¿»è¯‘æˆäº†ä¸­æ–‡<a href="http://www.cocoachina.com/industry/20131213/7537.html">Part1</a>ï¼Œ<a href="http://blog.sina.com.cn/s/blog_5c5c87d80101dzyh.html">Part2</a>ã€‚</p>

<p><code>Xcode</code>æä¾›äº†ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½<code>Preview</code>ã€‚å½“æˆ‘ä»¬åœ¨<code>Storyboard</code>ä¸Šä½¿ç”¨<code>Auto Layout</code>ä¸Šè¿›è¡Œå¸ƒå±€ä»¥åï¼Œç”±äºç›®å‰çš„ç”»å¸ƒ<code>canvas</code>å·²ç»æ²¡æœ‰å°ºå¯¸çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¸ƒå±€å®Œæˆåéœ€è¦åœ¨3.5ã€4.0ã€4.7ã€5.5è‹±å¯¸çš„è®¾å¤‡ä¸Šæµ‹è¯•ï¼Œå¦‚æœæ”¯æŒæ—‹è½¬æˆ–è€…æ”¯æŒiPadï¼Œä¸€ä¸ªæ•ˆæœæˆ‘ä»¬ä¼šbuildå¤šæ¬¡åœ¨ä¸åŒçš„è®¾å¤‡ä¸ŠæŸ¥çœ‹æ•ˆæœã€‚éå¸¸çš„éº»çƒ¦ï¼Œä½†æ˜¯æœ‰äº†<code>Preview</code>åä¸€åˆ‡éƒ½å˜å¾—ç®€å•èµ·æ¥ã€‚
ä½¿ç”¨<code>Preview</code>çš„æ­¥å¥å¦‚ä¸‹ï¼š</p>

<p>1ã€é€‰ä¸­<code>Main.storyboard</code>,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€‰å–çš„æ—¶å€™æŒ‰ä¸‹<code>option+shift</code>æŒ‰é”®ã€‚</p>

<p><img src="http://ww2.sinaimg.cn/mw690/8f7a6fe0jw1eya4nzk6ywj20b204p74o.jpg" alt="é€‰æ‹©storyboard" /></p>

<p>2ã€é€‰å–<code>Preview</code>åä¼šå‡ºæ¥å¦‚ä¸‹çš„ç•Œé¢ï¼Œé€‰æ‹©ç•Œé¢å³è¾¹çš„<code>+</code>å·ï¼ŒæŒ‰<code>å›è½¦</code>ã€‚</p>

<p><img src="http://ww1.sinaimg.cn/mw690/8f7a6fe0jw1eya4nzzeuxj20bc05daae.jpg" alt="image" /></p>

<p>3ã€é€šè¿‡æ­¥éª¤<code>2</code>åï¼Œä¼šå‡ºç°ä»¥ä¸‹çš„ç•Œé¢ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/mw690/8f7a6fe0jw1eya4o08srqj20f70gh0t6.jpg" height="520" width="500" alt="Previewç•Œé¢" /></p>

<p>å…³é”®çš„å‡ ä¸ªåœ°æ–¹æˆ‘éƒ½ç”¨çº¢æ–¹æ¡†åœˆäº†èµ·æ¥ï¼Œå·¦ä¸‹è§’çš„<code>+</code>èƒ½æ¨¡æ‹Ÿä¸åŒçš„è®¾å¤‡ï¼Œä¸­é—´çš„çº¢æ¡†éƒ¨ä½å¯ä»¥æ¨¡æ‹Ÿè®¾å¤‡çš„æ—‹è½¬ï¼Œ
å³ä¸‹è§’çš„<code>English</code>éƒ¨ä½å¯ä»¥æ¨¡æ‹Ÿå¸ƒå±€ä¸­çš„æ–‡å­¦ä¿¡æ¯åŒå€åçš„å¸ƒå±€è¡¨ç°ï¼Œè¿™å‡ ä¸ªåŠŸèƒ½éƒ½éå¸¸çš„æ–¹ä¾¿ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Appä¸­æ‹¨æ‰“ç”µè¯ä¸€ç‚¹å°æ€»ç»“]]></title>
    <link href="http://summertreee.github.io/blog/2015/08/23/appzhong-bo-da-dian-hua-%5B%3F%5D-dian-xiao-zong-jie/"/>
    <updated>2015-08-23T12:27:08+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/08/23/appzhong-bo-da-dian-hua-[?]-dian-xiao-zong-jie</id>
    <content type="html"><![CDATA[<h3>Appå†…å‘èµ·ç”µè¯æ‹¨æ‰“çš„ä¸€ç‚¹å°æŠ€å·§</h3>

<h4>ä¸€ã€æ‹¨æ‰“ç”µè¯</h4>

<p>åœ¨Appå†…å‘èµ·ç”µè¯æ‹¨æ‰“ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>

<p>1ã€åˆ©ç”¨è¿™ç§æ–¹å¼å‘èµ·çš„ç”µè¯æ‹¨æ‰“ï¼Œé€šè¯ç»“æŸåä¸ä¼šç›´æ¥è¿”å›Appå†…ï¼Œè€Œæ˜¯åœç•™åœ¨é€šä¿¡å½•é‡Œé¢ï¼š</p>

<pre><code> NSString *str = [[NSString alloc] initWithFormat:@"tel:%@",@"131xxxx1909"];
[[UIApplication sharedApplication] openURL:[NSURL URLWithString:str]];
</code></pre>

<!--more-->


<p>2ã€åˆ©ç”¨<code>UIWebView</code>å®ç°ç”µè¯æ‹¨æ‰“ï¼Œä¼šå¼¹å‡ºæ‹¨æ‰“æç¤ºï¼Œå¹¶ä¸”æ‹¨æ‰“å®Œæˆåä¼šè¿”å›Appå†…ï¼š</p>

<pre><code>NSString *phone = @"131****1909";
NSString *cleanedString =[[phone componentsSeparatedByCharactersInSet:[[NSCharacterSet characterSetWithCharactersInString:@"0123456789-+()"] invertedSet]] componentsJoinedByString:@""];
NSString *escapedPhoneNumber = [cleanedString stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];
NSURL *telURL = [NSURL URLWithString:[NSString stringWithFormat:@"tel://%@",escapedPhoneNumber]];
UIWebView *mCallWebview = [[UIWebView alloc] init] ;

[self.view addSubview:mCallWebview];
[mCallWebview loadRequest:[NSURLRequest requestWithURL:telURL]];
</code></pre>

<h4>äºŒã€æ£€æµ‹é€šè¯æ—¶é—´</h4>

<p>åˆ©ç”¨<code>CTCallCenter</code>æˆ‘ä»¬å¯ä»¥æ£€æµ‹åœ¨ä½¿ç”¨AppæœŸé—´æ‹¨æ‰“ç”µè¯å‡ºå»ä»¥åŠç”µè¯æ‰“å…¥çš„æ—¶æœºï¼Œä»¥åŠé€šè¯ç»“æŸçš„æ—¶æœºã€‚å®ç°å¦‚ä¸‹ï¼š</p>

<pre><code> #import &lt;CoreTelephony/CTCallCenter.h&gt;
 #import &lt;CoreTelephony/CTCall.h&gt;

 @interface AppDelegate : UIResponder&lt;UIApplicationDelegate&gt;
 @property (nonatomic, strong) CTCallCenter *callCenter;
 @end

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  self.callCenter = [[CTCallCenter alloc] init];
  [self handleCall];
  return YES;
}

-(void)handleCall
{
   self.callCenter.callEventHandler = ^(CTCall *call) {
    if ([call.callState isEqualToString: CTCallStateConnected])
    {
        NSLog(@"æ¥é€šç”µè¯");
    }
    else if ([call.callState isEqualToString: CTCallStateDialing])
    {
        NSLog(@"å‘èµ·å‘¼å«");
    }
    else if ([call.callState isEqualToString: CTCallStateDisconnected])
    {
        NSLog(@"ç»“æŸç”µè¯");
    }
    else if ([call.callState isEqualToString: CTCallStateIncoming])
    {
        NSLog(@"æ‰“å…¥ç”µè¯");
    }
   };
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xcodeæ§åˆ¶å°æ‰“å°CGRect]]></title>
    <link href="http://summertreee.github.io/blog/2015/06/15/xcodekong-zhi-tai-da-yin-cgrect/"/>
    <updated>2015-06-15T21:15:58+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/06/15/xcodekong-zhi-tai-da-yin-cgrect</id>
    <content type="html"><![CDATA[<p>åœ¨ç”¨Xcodeè°ƒè¯•å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨æ§åˆ¶å°æ‰“å°æŸä¸ªè§†å›¾çš„frameï¼Œä»¥å‰çš„æ—¶å€™ç›¸å½“éº»çƒ¦ï¼Œä½†æ˜¯ä»Xcode6.3ä»¥åï¼Œæ‰“å°frameå˜å¾—å¾ˆç®€å•ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Before
</span><span class='line'>(lldb) p (CGRect) [self frame]
</span><span class='line'>(CGRect) $0 = (origin = (x = 0, y = 0), size = (width = 50, height = 100))
</span><span class='line'> 
</span><span class='line'>// After
</span><span class='line'>(lldb) expr @import UIKit
</span><span class='line'>(lldb) p self.frame
</span><span class='line'>(CGRect) $1 = (origin = (x = 0, y = 0), size = (width = 50, height = 100))
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AFNetworking2.0ä½¿ç”¨å¿ƒå¾—]]></title>
    <link href="http://summertreee.github.io/blog/2015/05/13/afnetworking2-dot-0shi-yong-xin-de/"/>
    <updated>2015-05-13T13:56:23+08:00</updated>
    <id>http://summertreee.github.io/blog/2015/05/13/afnetworking2-dot-0shi-yong-xin-de</id>
    <content type="html"><![CDATA[<p>è¿™æ®µæ—¶é—´è¦å°†å…¬å¸é¡¹ç›®ä¸­çš„ç½‘ç»œå¼•æ“ç”±<a href="http://allseeing-i.com/ASIHTTPRequest/">ASIHTTPRequest</a>æ›¿æ¢ä¸º<a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a>,æ›¿æ¢çš„è¿‡ç¨‹æ¯”è¾ƒæ›²æŠ˜ï¼Œåœ¨æ­¤è®°å½•ä¸‹è‡ªå·±æ›¿æ¢è¿‡ç¨‹ä¸­å¾—å¿ƒå¾—ï¼š</p>

<h3>1ã€å»ºç«‹æ•°æ®è¯·æ±‚ä¸­ä»‹è€…</h3>

<p>å»ºç«‹<code>ä¸­ä»‹è€…</code>æ˜¯æŒ‡é¡¹ç›®ä¸­çš„æ•°æ®è¯·æ±‚éƒ½é€šè¿‡å®ƒå»å®ç°ï¼Œè€Œä¸æ˜¯æ¯ä¸€ä¸ªæ•°æ®è¯·æ±‚éƒ½ç›´æ¥ä¸<code>AFNetworking</code>æ‰“äº¤é“ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>

<ul>
<li>å°†ç½‘ç»œè¯·æ±‚ä¸ç¬¬ä¸‰æ–¹åº“ä¾èµ–éš”ç¦»å¼€æ¥ï¼Œæ–¹ä¾¿ä»¥åå¯¹ç¬¬ä¸‰æ–¹åº“çš„æ›¿æ¢ã€‚</li>
<li>æ–¹ä¾¿å¤„ç†ç½‘ç»œè¯·æ±‚çš„å…¬å…±é€»è¾‘ã€‚</li>
</ul>


<!--more-->


<h3>2ã€ä½¿ç”¨completionQueue</h3>

<p>é»˜è®¤æƒ…å†µä¸‹<code>AFURLConnectionOperation</code>æˆ–è€…<code>AFHTTPRequestOperation</code>è¯·æ±‚ç»“æŸä»¥åä¼šåœ¨ä¸»çº¿ç¨‹å°†ç»“æœä¼ é€’å›æ¥ï¼Œå¦‚æœä½ è¦å°†è¯·æ±‚çš„ç»“æœåšä¸€äº›è€—æ—¶çš„å¤æ‚çš„å¤„ç†ï¼Œå°±ä¼š<em>block</em>ä½ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ä½ å°±éœ€è¦å¯¹è¯·æ±‚çš„Operationä¼ é€’<code>completionQueue</code>å‚æ•°ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AFHTTPRequestOperation *request = [[AFHTTPRequestOperation alloc] initWithRequest:urlrequest];
</span><span class='line'>
</span><span class='line'>request.responseSerializer = [AFJSONResponseSerializer serializer];
</span><span class='line'>//è®¾ç½®å›è°ƒçš„queueï¼Œé»˜è®¤æ˜¯åœ¨mainQueueæ‰§è¡Œblockå›è°ƒ
</span><span class='line'>request.completionQueue = your_request_operation_completion_queue();
</span><span class='line'>[request setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
</span><span class='line'>         //è®¾ç½®äº†'completionQueue'åï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œå¤„ç†å¤æ‚çš„é€»è¾‘
</span><span class='line'>         //ä¸ç”¨æ‹…å¿ƒblockä½äº†ä¸»çº¿ç¨‹
</span><span class='line'>    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
</span><span class='line'>
</span><span class='line'> }];
</span><span class='line'> [request start];
</span></code></pre></td></tr></table></div></figure>


<h3>3ã€å¦‚ä½•çŸ¥é“AFHTTPRequestOperationManageræ‰§è¡Œå®Œæˆ</h3>

<p>å¼€å§‹ä»¥ä¸ºç›´æ¥è®¾ç½®<code>AFHTTPRequestOperationManager</code>çš„<em>completionGroup</em>ï¼Œç„¶ååˆ©ç”¨<code>dispatch_group_notify</code>æ¥è·å–operationQueueæ‰§è¡Œç»“æŸçš„é€šçŸ¥ï¼Œæœ€åæ‰å‘ç°ï¼Œè¿™æ ·æ ¹æœ¬ä¸è¡Œï¼Œçœ‹äº†æºç æ‰çŸ¥é“ï¼š<code>AFHTTPRequestOperationManager</code>ç›´æ¥å°†<em>completionGroup</em>èµ‹å€¼ç»™äº†ä»–çš„æ¯ä¸€ä¸ª<em>operation</em>ï¼Œåœ¨<em>operation</em>çš„completionBlocké‡Œé¢åˆ©ç”¨<em>completionGroup</em>ï¼Œæ¥ç¡®ä¿åœ¨operationçš„å¤„ç†å®Œæˆåï¼Œå°†completionBlockç½®ä¸ºnilï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚</p>

<p>è™½ç„¶è¯´è¿™æ ·ä¸èƒ½çŸ¥é“<code>AFHTTPRequestOperationManager</code>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œæˆï¼Œä½†æ˜¯ç”Ÿæ´»è¿˜å¾—ç»§ç»­ä¸‹å»å•Šï¼åœ¨<code>AFURLConnectionOperation</code>ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å«ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ (NSArray *)batchOfRequestOperations:(NSArray *)operations
</span><span class='line'>                        progressBlock:(void (^)(NSUInteger numberOfFinishedOperations, NSUInteger totalNumberOfOperations))progressBlock
</span><span class='line'>                      completionBlock:(void (^)(NSArray *operations))completionBlock;
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯èƒ½å¤Ÿå‘ä¸€ç»„è¯·æ±‚ï¼Œè·Ÿ<code>AFHTTPRequestOperationManager</code>æ¯”èµ·æ¥çš„ç¼ºç‚¹å°±æ˜¯æ²¡æ³•è®¾ç½®å¹¶å‘æ•°ï¼Œä½†æ˜¯å®ƒå´èƒ½å®ç°æ£€æµ‹ä¸€ç»„è¯·æ±‚ä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œèƒ½æ£€æµ‹å®Œæˆäº†å¤šå°‘è¯·æ±‚ï¼Œå®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p>

<p>åŸæ¥ä»–ä¹Ÿæ˜¯åˆ©ç”¨<strong>dispatch_group_async</strong>å’Œ<strong>dispatch_group_notify</strong></p>

<p>ä¸€èˆ¬çš„æˆ‘ä»¬è¦æŠŠä¸€ä¸ªä»»åŠ¡åŠ å…¥ä¸€ä¸ªgroupé‡Œæ˜¯è¿™æ ·ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_async(group, queue, ^{
</span><span class='line'>    block();
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªå†™æ³•ç­‰ä»·äº</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_async(queue, ^{
</span><span class='line'>    dispatch_group_enter(group);
</span><span class='line'>    block()
</span><span class='line'>    dispatch_group_leave(group);
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœè¦æŠŠä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡åŠ å…¥groupï¼Œè¿™æ ·å°±è¡Œä¸é€šäº†ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_async(group, queue, ^{
</span><span class='line'>    [self performBlock:^(){
</span><span class='line'>        block();
</span><span class='line'>    }];
</span><span class='line'>    //æœªæ‰§è¡Œåˆ°block() groupä»»åŠ¡å°±å·²ç»å®Œæˆäº†
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ˜¯å°±éœ€è¦ç”¨åˆ°<code>batchOfRequestOperations</code>é‡Œçš„å®ç°äº†ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_enter(group);
</span><span class='line'>[self performBlock:^(){
</span><span class='line'>    block();
</span><span class='line'>    dispatch_group_leave(group);
</span><span class='line'>}];
</span></code></pre></td></tr></table></div></figure>


<p>å…¶å®è¿™ä¸ªå’Œå¼•ç”¨è®¡æ•°å·®ä¸å¤šï¼Œ<em>dispatch_group_enter</em>æ—¶å¼•ç”¨è®¡æ•°+1ï¼Œ<em>dispatch_group_leave</em>æ—¶å¼•ç”¨è®¡æ•°-1ï¼Œå¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰§è¡Œ<em>dispatch_group_notify</em>çš„å†…å®¹ã€‚å…·ä½“è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AFHTTPRequestOperationManager *downloadManager = [AFHTTPRequestOperationManager manager];
</span><span class='line'>    //è®¾ç½®æœ€å¤§å¹¶å‘æ•°
</span><span class='line'>    [downloadManager.operationQueue setMaxConcurrentOperationCount:([NSProcessInfo processInfo].processorCount) * 2];
</span><span class='line'>    //åˆ›å»ºä¸€ä¸ªgroup
</span><span class='line'>    __block dispatch_group_t group = dispatch_group_create();
</span><span class='line'>    for (NSURL *url in urlArray) {
</span><span class='line'>        NSURLRequest *requestUrl = [NSURLRequest requestWithURL:url];
</span><span class='line'>        AFHTTPRequestOperation *requestOperation = [[AFHTTPRequestOperation alloc] initWithRequest:requestUrl];
</span><span class='line'>        [requestOperation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
</span><span class='line'>            dispatch_group_leave(group);
</span><span class='line'>            
</span><span class='line'>        } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
</span><span class='line'>            dispatch_group_leave(group);
</span><span class='line'>            
</span><span class='line'>        }];
</span><span class='line'>        //å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ä¸­
</span><span class='line'>        [downloadManager.operationQueue addOperation:requestOperation];
</span><span class='line'>        dispatch_group_enter(group);
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    dispatch_group_notify(group, dispatch_get_main_queue(), ^{
</span><span class='line'>        //å…¨éƒ¨è¯·æ±‚å®Œæˆ
</span><span class='line'>        
</span><span class='line'>    });  </span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>4ã€å®ç°æ–­ç‚¹ç»­ä¼ </h3>

<p><code>AFNetworking</code>è™½ç„¶æ”¯æŒæ–‡ä»¶ä¸‹è½½çš„æš‚åœå’Œç»§ç»­ï¼Œä½†æ˜¯å½“ç¼“å­˜æ¸…ç©ºé‡æ–°å¯åŠ¨æ—¶ï¼Œå®ƒå¹¶æ²¡æœ‰è®°å½•ä¸‹ä¸‹è½½çš„çŠ¶æ€ï¼Œæ— æ³•ç»­ä¼ ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<a href="http://https://github.com/steipete/AFDownloadRequestOperation">AFDownloadRequestOperation</a>æ¥ç®€å•çš„å®ç°ï¼Œå…¶å®è¿‡ç¨‹ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¤§è‡´å¦‚ä¸‹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥é˜…è¯»<code>AFDownloadRequestOperation</code>æ˜¯å®ç°éƒ¨åˆ†ï¼š</p>

<p>1ã€è®¾ç½®<code>AFHTTPRequestOperation</code>çš„è¯·æ±‚<code>NSMutableURLRequest</code><em>HTTPHeader</em>çš„<strong>Range</strong>å­—æ®µã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSMutableURLRequest *mutableURLRequest = [self.request mutableCopy];
</span><span class='line'>//offsetæ˜¯æŒ‡æ–­ç‚¹ç»­ä¼ æ–‡ä»¶å·²ç»ä¸‹è½½çš„å¤§å°
</span><span class='line'>[mutableURLRequest setValue:[NSString stringWithFormat:@"bytes=%llu-", offset] forHTTPHeaderField:@"Range"];</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>2ã€è®¾ç½®<code>AFHTTPRequestOperation</code>çš„<em>outputStream</em>å±æ€§ã€‚</p>

<pre><code class="` "> //downloadPathæ˜¯æŒ‡æ–‡ä»¶ä¸‹è½½å­˜æ”¾çš„è·¯å¾„
downloadOperation.outputStream = [NSOutputStream outputStreamToFileAtPath:downloadPath append:YES];
</code></pre>

<h3>ç»“å°¾</h3>

<p>å¯¹äº<code>ASIHTTPRequest</code>å’Œ<code>AFNetworking</code>çš„æ¯”è¾ƒç½‘ä¸Šæœ‰å¾ˆå¤šå¾ˆå¥½çš„æ–‡ç« ï¼Œä¸€æœä¸€å¤§æŠŠï¼Œå¯¹äºæ™®é€šçš„ä½¿ç”¨æ¥è¯´æ„Ÿè§‰åŒºåˆ«ä¸å¤§ï¼Œè¯·æ±‚é€Ÿåº¦ä»€ä¹ˆçš„ä¹Ÿæ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼Œä»¥ä¸Šè‹¥æœ‰é”™è¯¯ï¼Œè¿˜æœ›å¤§å®¶å¤šå¤š
æŒ‡æ­£ğŸ˜ƒã€‚</p>
]]></content>
  </entry>
  
</feed>
